name: server

dependencies:
  - python=3.8.12
  - conda-forge::protobuf=3.20.1
  - conda-forge::pyyaml
  - conda-forge::orjson
  - pytorch::pytorch=1.12.*
  - conda-forge::scikit-build=0.14.1
  - conda-forge::cudatoolkit=11.6
  - conda-forge::cudnn
  - conda-forge::uvicorn[standard]=0.14.0
  - conda-forge::gunicorn
  - conda-forge::fastapi_utils=0.2.1
  - conda-forge::googledrivedownloader=0.4
  - conda-forge::botocore=1.22.6
  - conda-forge::sentencepiece=0.1.96
  - conda-forge::pip
  - conda-forge::python-forge=18.6.0
  - conda-forge::tensorflow=2.8.1
  - conda-forge::ffmpeg-python
  - conda-forge::onnxruntime
  - conda-forge::pytest
  - conda-forge::geopy
  - conda-forge::spacy # unfortunately, spacy can't be offset to custom env due to the way you init language models
  - conda-forge::dataprep
  - conda-forge::pydub
  - conda-forge::pysoundfile
  - conda-forge::ftfy
  - conda-forge::flax
  - conda-forge::jax=8.2.0
  - conda-forge::python-swiftclient=4.1.0
  - conda-forge::python-keystoneclient=5.0.1
  - conda-forge::validators=0.18.2
  - conda-forge::pydub
  - pip:
    - --extra-index-url=https://pypi.ngc.nvidia.com --trusted-host pypi.ngc.nvidia.com nvidia-pyindex
    - --extra-index-url=https://pypi.ngc.nvidia.com --trusted-host pypi.ngc.nvidia.com nvidia-cudnn
    - git+https://github.com/Thytu/fastapi.git
    - prometheus_fastapi_instrumentator==5.7.1
    - -e /app/api_utils/
    - keybert
    - happytransformer # TODO: remove this package and build this env using templates
    - stt
    - truecase==0.0.14 # addin truecase here for all transformers as results are case sensitive
    - git+https://github.com/huggingface/diffusers.git
    - ml_collections # TODO: remove this and create a proper custom env for Maxim model
    - git+https://github.com/google-research/maxim.git # TODO: remove this and create a proper custom env for Maxim model
    - git+https://github.com/openai/whisper.git # TODO: remove this and create a proper custom env for whisper model
    - deepmultilingualpunctuation==1.0.0 #only depends on transformers and torch no need to isolate and will be used in many other models
    - pyannote.core
    - pyannote.database
    - pyannote.metrics
    - pyannote.audio
    - torchaudio
    - torchvision
    - accelerate==0.14.0
    - git+https://github.com/yinruiqing/pyannote-whisper.git
    - nvidia-ml-py3
    - git+https://github.com/huggingface/transformers.git
